<%
  if @query.present?
    set_page_meta(
      title: "\"#{@query}\" #{I18n.locale == :ko ? '검색 결과' : 'Search Results'} - #{t('blog.title')}",
      description: I18n.locale == :ko ?
        "L-BIZ Partners 블로그에서 \"#{@query}\" 관련 글을 찾아보세요." :
        "Find \"#{@query}\" related articles on L-BIZ Partners blog.",
      keywords: I18n.locale == :ko ?
        "블로그, #{@query}, 비즈니스 인사이트, L-BIZ Partners" :
        "blog, #{@query}, business insights, L-BIZ Partners"
    )
  else
    set_page_meta(
      title: t("blog.title"),
      description: I18n.locale == :ko ?
        "L-BIZ Partners의 비즈니스 인사이트, 트렌드 분석, 프로젝트 경험담을 공유합니다. 전문가들의 실무 노하우와 업계 최신 동향을 확인하세요." :
        "L-BIZ Partners shares business insights, trend analysis, and project experiences. Discover expert know-how and the latest industry trends.",
      keywords: I18n.locale == :ko ?
        "비즈니스 블로그, 컨설팅 인사이트, 트렌드 분석, 프로젝트 관리, 비즈니스 팁" :
        "business blog, consulting insights, trend analysis, project management, business tips"
    )
  end
%>

<% content_for :json_ld do %>
  <%= json_ld_tag(breadcrumb_json_ld([
    { name: I18n.locale == :ko ? "홈" : "Home", url: root_path },
    { name: t("blog.title"), url: nil }
  ])) %>
<% end %>

<!-- Hero Section -->
<section class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h1 class="text-4xl md:text-5xl font-bold mb-4"><%= t("blog.title") %></h1>
    <p class="text-xl text-indigo-100 max-w-2xl mx-auto mb-8">
      <%= t("blog.subtitle") %>
    </p>

    <!-- Search Form -->
    <%= form_with url: blog_index_path, method: :get, local: true, class: "max-w-xl mx-auto" do %>
      <div class="flex gap-2">
        <div class="relative flex-grow">
          <input type="text" name="q" value="<%= @query %>"
                 placeholder="<%= t('blog.search.placeholder') %>"
                 class="w-full px-4 py-3 pl-12 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-300">
          <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        <button type="submit" class="px-6 py-3 bg-indigo-900 text-white rounded-lg font-medium hover:bg-indigo-950 transition-colors">
          <%= t("blog.search.button") %>
        </button>
      </div>
    <% end %>
  </div>
</section>

<% if @query.present? %>
  <!-- Search Results Header -->
  <section class="py-6 bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between">
        <p class="text-gray-600">
          "<span class="font-semibold text-gray-900"><%= @query %></span>"
          <%= I18n.locale == :ko ? "검색 결과" : "search results" %>
          <span class="text-indigo-600 font-medium">(<%= @posts.size %><%= I18n.locale == :ko ? "개" : "" %>)</span>
        </p>
        <%= link_to I18n.locale == :ko ? "전체 보기" : "View All", blog_index_path, class: "text-indigo-600 hover:text-indigo-800 font-medium" %>
      </div>
    </div>
  </section>
<% end %>

<% if @posts.any? %>
  <% unless @query.present? %>
  <!-- Featured Post -->
  <section class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <% featured = @posts.first %>
      <%= link_to blog_path(featured.id), class: "group block" do %>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
          <div class="aspect-video rounded-xl overflow-hidden bg-gray-100">
            <% if featured.large_url.present? || featured.image_url.present? %>
              <img src="<%= featured.large_url || featured.image_url %>" alt="<%= featured.title %>"
                   class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-indigo-400 to-purple-600 flex items-center justify-center">
                <span class="text-white text-6xl font-bold opacity-50">B</span>
              </div>
            <% end %>
          </div>
          <div>
            <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium mb-4">
              <%= t("blog.featured") %>
            </span>
            <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 group-hover:text-indigo-600 transition-colors">
              <%= featured.title %>
            </h2>
            <p class="text-gray-600 mb-4 text-lg">
              <%= featured.excerpt %>
            </p>
            <div class="flex items-center text-sm text-gray-500">
              <span class="font-medium text-gray-900"><%= featured.author %></span>
              <span class="mx-2">·</span>
              <span><%= featured.published_at&.strftime("%Y-%m-%d") %></span>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </section>
  <% end %>

  <!-- Category Filter -->
  <section class="bg-gray-50 border-y">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex flex-wrap gap-2 justify-center">
        <span class="px-4 py-2 bg-indigo-600 text-white rounded-full text-sm font-medium cursor-pointer">
          <%= I18n.locale == :ko ? "전체" : "All" %>
        </span>
        <span class="px-4 py-2 bg-white text-gray-700 rounded-full text-sm font-medium cursor-pointer hover:bg-gray-100 transition-colors border">
          <%= I18n.locale == :ko ? "트렌드" : "Trends" %>
        </span>
        <span class="px-4 py-2 bg-white text-gray-700 rounded-full text-sm font-medium cursor-pointer hover:bg-gray-100 transition-colors border">
          <%= I18n.locale == :ko ? "프로젝트" : "Projects" %>
        </span>
        <span class="px-4 py-2 bg-white text-gray-700 rounded-full text-sm font-medium cursor-pointer hover:bg-gray-100 transition-colors border">
          <%= I18n.locale == :ko ? "케이스스터디" : "Case Study" %>
        </span>
        <span class="px-4 py-2 bg-white text-gray-700 rounded-full text-sm font-medium cursor-pointer hover:bg-gray-100 transition-colors border">
          <%= I18n.locale == :ko ? "회사소식" : "Company News" %>
        </span>
        <span class="px-4 py-2 bg-white text-gray-700 rounded-full text-sm font-medium cursor-pointer hover:bg-gray-100 transition-colors border">
          <%= I18n.locale == :ko ? "팁" : "Tips" %>
        </span>
      </div>
    </div>
  </section>

  <!-- Blog Posts Grid -->
  <section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        <% posts_to_show = @query.present? ? @posts : @posts.drop(1) %>
        <% posts_to_show.each do |post| %>
          <%= link_to blog_path(post.id), class: "group" do %>
            <article class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-lg transition-shadow duration-300 h-full flex flex-col">
              <div class="aspect-video overflow-hidden bg-gray-100">
                <% if post.medium_url.present? || post.image_url.present? %>
                  <img src="<%= post.medium_url || post.image_url %>" alt="<%= post.title %>"
                       class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                <% else %>
                  <div class="w-full h-full bg-gradient-to-br from-indigo-400 to-purple-600 flex items-center justify-center">
                    <span class="text-white text-4xl font-bold opacity-50">B</span>
                  </div>
                <% end %>
              </div>
              <div class="p-6 flex-grow flex flex-col">
                <div class="flex items-center gap-2 mb-3">
                  <% if post.category.present? %>
                    <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-medium">
                      <%= post.category %>
                    </span>
                  <% end %>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-indigo-600 transition-colors">
                  <%= post.title %>
                </h3>
                <p class="text-gray-600 text-sm line-clamp-2 flex-grow">
                  <%= post.excerpt %>
                </p>
                <div class="flex items-center text-sm text-gray-500 mt-4 pt-4 border-t">
                  <span class="font-medium text-gray-700"><%= post.author %></span>
                  <span class="mx-2">·</span>
                  <span><%= post.published_at&.strftime("%Y-%m-%d") %></span>
                </div>
              </div>
            </article>
          <% end %>
        <% end %>
      </div>
    </div>
  </section>
<% else %>
  <!-- Empty State -->
  <section class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <% if @query.present? %>
        <h2 class="text-xl font-bold text-gray-900 mb-2"><%= t("blog.search.no_results") %></h2>
        <p class="text-gray-600 mb-4"><%= I18n.locale == :ko ? "다른 키워드로 검색해 보세요." : "Try a different keyword." %></p>
        <%= link_to I18n.locale == :ko ? "전체 보기" : "View All", blog_index_path, class: "text-indigo-600 hover:text-indigo-800 font-medium" %>
      <% else %>
        <h2 class="text-xl font-bold text-gray-900 mb-2"><%= t("blog.no_posts") %></h2>
        <p class="text-gray-600"><%= I18n.locale == :ko ? "곧 새로운 콘텐츠로 찾아뵙겠습니다." : "New content coming soon." %></p>
      <% end %>
    </div>
  </section>
<% end %>

<!-- Newsletter CTA -->
<section class="bg-indigo-600 py-16">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">
      <%= I18n.locale == :ko ? "최신 소식을 받아보세요" : "Subscribe to Our Newsletter" %>
    </h2>
    <p class="text-indigo-100 mb-8">
      <%= I18n.locale == :ko ? "비즈니스 인사이트와 최신 트렌드를 이메일로 받아보실 수 있습니다." : "Get business insights and the latest trends delivered to your inbox." %>
    </p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto">
      <input type="email" placeholder="<%= I18n.locale == :ko ? '이메일 주소' : 'Email address' %>"
             class="flex-grow px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-white">
      <button class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-medium hover:bg-indigo-50 transition-colors">
        <%= I18n.locale == :ko ? "구독하기" : "Subscribe" %>
      </button>
    </div>
  </div>
</section>
