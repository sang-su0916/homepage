<%
  if @query.present?
    set_page_meta(
      title: "\"#{@query}\" #{I18n.locale == :ko ? '검색 결과' : 'Search Results'} - #{t('portfolio.title')}",
      description: I18n.locale == :ko ?
        "L-BIZ Partners의 \"#{@query}\" 관련 프로젝트 포트폴리오입니다." :
        "L-BIZ Partners portfolio related to \"#{@query}\".",
      keywords: I18n.locale == :ko ?
        "포트폴리오, #{@query}, 프로젝트, 비즈니스 사례" :
        "portfolio, #{@query}, projects, business cases"
    )
  else
    set_page_meta(
      title: t("portfolio.title"),
      description: I18n.locale == :ko ?
        "L-BIZ Partners가 성공적으로 수행한 프로젝트 사례를 확인하세요. 다양한 산업 분야의 비즈니스 컨설팅, IT 솔루션, 마케팅 프로젝트 경험이 있습니다." :
        "Check out the successful projects by L-BIZ Partners. We have experience in business consulting, IT solutions, and marketing projects across various industries.",
      keywords: I18n.locale == :ko ?
        "포트폴리오, 프로젝트 사례, 비즈니스 컨설팅, IT 프로젝트, 마케팅 사례" :
        "portfolio, project cases, business consulting, IT projects, marketing cases"
    )
  end
%>

<% content_for :json_ld do %>
  <%= json_ld_tag(breadcrumb_json_ld([
    { name: I18n.locale == :ko ? "홈" : "Home", url: root_path },
    { name: t("portfolio.title"), url: nil }
  ])) %>
<% end %>

<!-- Page Header -->
<section class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-16">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <h1 class="text-3xl md:text-4xl font-bold mb-4"><%= t("portfolio.title") %></h1>
    <p class="text-blue-100 mb-8"><%= t("portfolio.subtitle") %></p>

    <!-- Search Form -->
    <%= form_with url: portfolios_path, method: :get, local: true, class: "max-w-xl mx-auto" do %>
      <div class="flex gap-2">
        <div class="relative flex-grow">
          <input type="text" name="q" value="<%= @query %>"
                 placeholder="<%= t('portfolio.search.placeholder') %>"
                 class="w-full px-4 py-3 pl-12 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-300">
          <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
        <button type="submit" class="px-6 py-3 bg-blue-900 text-white rounded-lg font-medium hover:bg-blue-950 transition-colors">
          <%= t("portfolio.search.button") %>
        </button>
      </div>
    <% end %>
  </div>
</section>

<!-- Portfolio Grid -->
<section class="py-16 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <% if @query.present? %>
      <div class="mb-8 flex items-center justify-between">
        <p class="text-gray-600">
          "<span class="font-semibold text-gray-900"><%= @query %></span>"
          <%= I18n.locale == :ko ? "검색 결과" : "search results" %>
          <span class="text-blue-600 font-medium">(<%= @portfolios.size %><%= I18n.locale == :ko ? "개" : "" %>)</span>
        </p>
        <%= link_to I18n.locale == :ko ? "전체 보기" : "View All", portfolios_path, class: "text-blue-600 hover:text-blue-800 font-medium" %>
      </div>
    <% end %>

    <% if @portfolios.any? %>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        <% @portfolios.each do |portfolio| %>
          <%= link_to portfolio_path(portfolio.id), class: "group" do %>
            <article class="bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300">
              <!-- Image or Placeholder -->
              <div class="h-56 bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center relative overflow-hidden">
                <% if portfolio.medium_url.present? || portfolio.image_url.present? %>
                  <img src="<%= portfolio.medium_url || portfolio.image_url %>" alt="<%= portfolio.title %>" class="w-full h-full object-cover">
                <% else %>
                  <span class="text-white text-6xl font-bold opacity-30"><%= portfolio.title[0] %></span>
                <% end %>
                <div class="absolute inset-0 bg-blue-900 opacity-0 group-hover:opacity-20 transition-opacity"></div>
              </div>

              <!-- Content -->
              <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-900 group-hover:text-blue-600 transition-colors mb-2">
                  <%= portfolio.title %>
                </h2>
                <p class="text-sm text-blue-600 font-medium mb-3"><%= portfolio.client %></p>
                <p class="text-gray-600 text-sm line-clamp-2">
                  <%= truncate(portfolio.description, length: 100) %>
                </p>
              </div>
            </article>
          <% end %>
        <% end %>
      </div>

      <%= render "shared/pagination" %>
    <% else %>
      <div class="text-center py-16">
        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <% if @query.present? %>
          <p class="text-gray-500 text-lg mb-4"><%= t("portfolio.search.no_results") %></p>
          <%= link_to I18n.locale == :ko ? "전체 보기" : "View All", portfolios_path, class: "text-blue-600 hover:text-blue-800 font-medium" %>
        <% else %>
          <p class="text-gray-500 text-lg"><%= t("portfolio.no_items") %></p>
        <% end %>
      </div>
    <% end %>
  </div>
</section>

<!-- CTA Section -->
<section class="py-12 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
    <p class="text-gray-600 mb-4"><%= t("home.contact.subtitle") %></p>
    <%= link_to t("nav.contact"), new_contact_path, class: "inline-block bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors" %>
  </div>
</section>
